<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>공포이야기 - 모르는 번호 공포썰</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {

            padding: 30px;
            font-family: 'SUIT', sans-serif;
            background: linear-gradient(135deg, #eef1ff, #f4f6ff);
            color: #333;
        }

        .container {
            min-height: 90%;
            min-width: 80%;
            max-width: 1800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 60px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            position: relative;
            display: block;
        }

        .category {
            font-size: 13px;
            color: #888;
            margin-bottom: 6px;
        }

        .post-title {
            font-size: 22px;
            font-weight: 400;
            margin-bottom: 10px;
        }

        .top-row {
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 400;
            margin-bottom: 8px;
        }

        .top-row .category {
            color: #666;
        }

        .top-row .separator {
            margin: 0 8px;
            color: #bbb;
        }

        .top-row .post-title {
            color: #222;
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: #888;
            margin-bottom: 10px;
        }

        .meta-row .right span {
            margin-left: 15px;
        }

        .meta-row .right .red #commentCount {
            color: red;
        }

        hr {
            border: none;
            border-top: 1px solid #ddd;
            margin: 12px 0 20px;
        }

        .post-content {
            font-size: 15px;
            line-height: 1.7;
            white-space: pre-wrap;
            margin-bottom: 30px;
            width: 90%;

        }

        .post-actions {
            text-align: right;
            margin-top: 10px;
            position: relative;
        }

        .post-actions button {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 13px;
            margin-left: 10px;
            position: relative;
        }

        .post-actions button:hover {
            color: #333;
        }

        .share-popup {
            display: none;
            position: absolute;
            right: 0;
            top: 30px;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.1);
            padding: 8px;
            z-index: 100;
            border-radius: 4px;
            width: 250px;
        }

        .share-popup input {
            width: calc(100% - 50px);
            padding: 5px;
            font-size: 13px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .share-popup button {
            padding: 5px 8px;
            font-size: 13px;
            margin-left: 5px;
            background: #6a3ae4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }


        .vote-buttons {
            margin-bottom: 40px;
            text-align: center;
        }

        .vote-buttons button {
            font-size: 16px;
            background: none;
            border: none;
            margin: 0px 20px;
            cursor: pointer;
            color: #444;
        }

        .vote-buttons span {
            margin-left: 5px;
            font-size: 14px;
        }

        /* 기존 스타일 유지하면서 댓글 입력창 스타일 및 댓글 리스트 스타일 추가 */
        .comment-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .comment-input input {
            flex: 1;
            height: 30px;
            padding: 6px 12px;
            font-family: inherit;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 15px;
        }

        .comment-input button {
            background: none;
            border: none;
            color: #333;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .comment-list-header {
            display: flex;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .comment-list-header .total-comments {
            color: #6a3ae4;
            margin-right: 15px;
        }

        .comment-list-header .tabs {
            color: #444;
            font-weight: 400;
            gap: 10px;
            display: flex;
        }

        .comment-list-header .tabs div {
            cursor: pointer;
            color: #888;
        }

        .comment-list-header .tabs div.active {
            color: #222;
            font-weight: 600;
        }

        .comment {
            display: flex;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .comment.reply {
            margin-left: 40px;
            border-left: 2px solid #f0f0f0;
            padding-left: 12px;
        }

        .comment .profile-icon {
            width: 28px;
            height: 28px;
            background: #ccc;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .comment .content {
            flex: 1;
        }

        .comment .author {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 2px;
        }

        .comment .text {
            font-size: 14px;
            color: #222;
            margin-bottom: 6px;
            white-space: pre-wrap;
        }

        .comment .actions {
            font-size: 13px;
            color: #888;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .comment .actions span {
            cursor: pointer;
            user-select: none;
        }

        .comment .actions .reply-toggle {
            color: #6a3ae4;
            cursor: pointer;
            font-weight: 600;
        }

        .comment .options-btn {
            position: absolute;
            right: 0;
            top: 12px;
            font-size: 18px;
            color: #aaa;
            cursor: pointer;
        }

        .reply-box {
            margin-top: 8px;
            display: none;
            gap: 10px;
            align-items: center;
        }

        .reply-box input {
            flex: 1;
            height: 28px;
            padding: 6px 12px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 15px;
        }

        .reply-box button {
            background: none;
            border: none;
            color: #333;
            font-weight: 600;
            cursor: pointer;
            font-size: 13px;
        }

        .options-popup {
            position: absolute;
            right: 0;
            top: 30px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            width: 120px;
            display: none;
            /* 기본 숨김 */
            z-index: 100;
            padding: 8px 0;
        }

        .options-popup div {
            padding: 8px 16px;
            font-size: 14px;
            color: #444;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .options-popup div:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- 카테고리 + 제목 -->
        <div class="top-row">
            <div class="category">공포이야기</div>
            <div class="separator">|</div>
            <div class="post-title">모르는 번호 공포썰</div>
        </div>

        <!-- 게시글 정보 -->
        <!--작성자, 작성일, 조회수, 추천수, 댓글수-->
        <div class="meta-row">
            <div class="left">작성자 익명 · 작성일 23.07.09 13:45</div>
            <div class="right">
                <span>조회수 305</span>
                <span>추천 <span id="recommendCount">0</span></span>
                <span class="red">댓글 <span id="commentCount">0</span></span>
            </div>
        </div>
        <hr>

        <!-- 공유 + 신고하기 버튼-->
        <div class="post-actions">
            <button class="share-btn">공유</button>
            <button class="report-btn">신고하기</button>

            <div class="share-popup" id="sharePopup">
                <input type="text" id="shareUrl" readonly value="https://example.com/post/123">
                <button onclick="copyUrl()">복사</button>
            </div>
        </div>

        <!-- 게시글 내용 -->
        <div class="post-content">
            첫 번째 메시지는 전화 받지 말랍니다.
            두 번째는 이 번호가 너를 따라다닌답니다.
            세 번째는...

            '앗아..수신자?'
        </div>

        <!-- 게시글 좋아요/싫어요 -->
        <div class="vote-buttons">
            <button id="likeBtn"><img src="../img/like.png" alt="likeBtn" height="40px"><span
                    id="likeCount">0</span></button>
            <button id="dislikeBtn"><img src="../img/dislike.png" alt="dislikeBtn" height="40px"><span
                    id="dislikeCount">0</span></button>
        </div>

        <hr>

        <!-- 댓글 리스트 상단 탭 영역 추가 -->
        <div class="comment-list-header">
            <div class="total-comments">전체 댓글 <span class="red" id="commentCountDisplay">0</span>개</div>
            <div class="tabs">
                <div class="active">등록순</div>
                <div>최신순</div>
                <div>답글순</div>
            </div>
        </div>

        <!-- 댓글 입력 부분 변경 -->
        <div class="comment-input">
            <div class="profile-icon"></div>
            <input id="commentText" type="text" placeholder="댓글 추가..." />
            <button id="addComment">등록</button>
        </div>

        <!-- 댓글 리스트 영역 추가 -->
        <div id="commentList"></div>
    </div>


    <script>
        // 좋아요수와 댓글수 변수 초기화
        let recommendCount = 0, commentCount = 0;

        // 댓글 수를 표시하는 요소들(#commentCount, #commentCountDisplay)의 텍스트를 댓글 수로 업데이트
        function updateCommentCount() {
            $('#commentCount, #commentCountDisplay').text(commentCount);
        }

        //게시글
        //좋아요 click
        $('#likeBtn').click(() => {
            // 현재 좋아요 수
            let likeCurrent = +$('#likeCount').text();
            $('#likeCount').text(likeCurrent + 1);  // 좋아요 1 증가

            // 싫어요 수 초기화
            $('#dislikeCount').text(0);

            // 추천 수에 좋아요 수 표시
            $('#recommendCount').text(likeCurrent + 1);

            // 이미지 변경
            $('#likeBtn img').attr('src', '../img/like_clike.png');
            $('#dislikeBtn img').attr('src', '../img/dislike.png');
        });

        //싫어요 click
        $('#dislikeBtn').click(() => {
            // 현재 싫어요 수
            let dislikeCurrent = +$('#dislikeCount').text();
            $('#dislikeCount').text(dislikeCurrent + 1);

            // 좋아요 수 초기화
            $('#likeCount').text(0);

            // 추천 수에 좋아요 수(0) 표시
            $('#recommendCount').text(0);

            // 이미지 변경
            $('#dislikeBtn img').attr('src', '../img/dislike_click.png');
            $('#likeBtn img').attr('src', '../img/like.png');
        });




        //댓글 추가 click
        $('#addComment').click(() => {
            const text = $('#commentText').val().trim();
            if (!text) return alert("댓글을 입력하세요.");

            const $comment = createComment(text);
            $('#commentList').append($comment);
            $('#commentText').val('');
            commentCount++;

            updateCommentCount();   //댓글 수 ui업데이트
        });

        //댓글 엘리먼트 생성(댓글 + 대댓글)
        function createComment(text, isReply = false) {
            const $cmt = $(`
        <div class="comment ${isReply ? 'reply' : ''}">
            <div class="profile-icon"></div>
            <div class="content">
                <div class="author">익명</div>
                <div class="text">${$('<div>').text(text).html()}</div>
                <div class="actions">
                    <span class="like"><img src="../img/like.png" alt="likeBtn" height="17px"> 0</span>
                    <span class="dislike"><img src="../img/dislike.png" alt="dislikeBtn" height="17px"> 0</span>
                    ${!isReply ? '<span class="reply-toggle">답글</span>' : ''}
                </div>
                ${!isReply ? `
                <div class="reply-box" style="display:none;">
                    <input type="text" placeholder="답글 추가..." />
                    <button class="reply-submit">등록</button>
                </div>` : ''}
            </div>
            <div class="options-btn">⋯</div>
            <div class="options-popup">
                <div class="report">신고하기</div>
                <div class="delete">삭제하기</div>
            </div>
        </div>
    `);

            // 좋아요/싫어요 상태 저장용
            let liked = false;
            let disliked = false;

            // 좋아요/싫어요 기능
            $cmt.find('.like').click(function () {
                let $likeSpan = $(this);
                let $dislikeSpan = $cmt.find('.dislike');

                let likeCount = parseInt($likeSpan.text().replace(/\D/g, ''));
                let dislikeCount = parseInt($dislikeSpan.text().replace(/\D/g, ''));

                if (liked) {
                    liked = false;
                    likeCount--;
                    $likeSpan.removeClass('active');
                    $likeSpan.find('img').attr('src', '../img/like.png');
                } else {
                    liked = true;
                    likeCount++;
                    if (disliked) {
                        disliked = false;
                        dislikeCount--;
                        $dislikeSpan.removeClass('active');
                        $dislikeSpan.find('img').attr('src', '../img/dislike.png');
                    }
                    $likeSpan.addClass('active');
                    $dislikeSpan.removeClass('active');
                    $likeSpan.find('img').attr('src', '../img/like_clike.png');
                }

                // 숫자만 변경 (텍스트 노드만 바꾸기)
                $likeSpan.contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith(' ' + likeCount);

                $dislikeSpan.contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith(' ' + dislikeCount);
            });

            //싫어요 click
            $cmt.find('.dislike').click(function () {
                let $dislikeSpan = $(this);
                let $likeSpan = $cmt.find('.like');

                let dislikeCount = parseInt($dislikeSpan.text().replace(/\D/g, ''));
                let likeCount = parseInt($likeSpan.text().replace(/\D/g, ''));

                if (disliked) {
                    disliked = false;
                    dislikeCount--;
                    $dislikeSpan.removeClass('active');
                    $dislikeSpan.find('img').attr('src', '../img/dislike.png');
                } else {
                    disliked = true;
                    dislikeCount++;
                    if (liked) {
                        liked = false;
                        likeCount--;
                        $likeSpan.removeClass('active');
                        $likeSpan.find('img').attr('src', '../img/like.png');
                    }
                    $dislikeSpan.addClass('active');
                    $likeSpan.removeClass('active');
                    $dislikeSpan.find('img').attr('src', '../img/dislike_click.png');
                }

                $dislikeSpan.contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith(' ' + dislikeCount);

                $likeSpan.contents().filter(function () {
                    return this.nodeType === 3;
                }).first().replaceWith(' ' + likeCount);
            });

            // 옵션 버튼 (⋯)
            $cmt.find('.options-btn').click(e => {
                e.stopPropagation();
                $('.options-popup').hide(); // 다른 팝업 닫기
                $cmt.find('.options-popup').toggle();
            });
            $(document).click(() => $('.options-popup').hide());

            // 삭제 기능
            $cmt.find('.delete').click(() => {
                if (confirm('댓글을 삭제하시겠습니까?')) {
                    if (!isReply) $cmt.next('.replies').remove();
                    $cmt.remove();
                    commentCount--;
                    updateCommentCount();
                }
            });

            // 신고 기능
            $cmt.find('.report').click(() => {
                alert('신고가 접수되었습니다.');
            });

            // 답글 토글
            $cmt.find('.reply-toggle').click(() => {
                $cmt.find('.reply-box').toggle();
                $cmt.find('.reply-box input').focus();
            });

            // 답글 등록
            $cmt.find('.reply-submit').click(() => {
                const txt = $cmt.find('.reply-box input').val().trim();
                if (!txt) return alert("답글을 입력하세요.");
                const $reply = createComment(txt, true);

                // .replies 컨테이너 찾거나 없으면 생성
                let $replies = $cmt.next('.replies');
                if (!$replies.length) {
                    $replies = $('<div class="replies"></div>');
                    $cmt.after($replies);
                }

                $replies.append($reply);
                $cmt.find('.reply-box input').val('');
                $cmt.find('.reply-box').hide();
                commentCount++;
                updateCommentCount();

                // 답글 접기/펼치기 토글 버튼 없으면 생성
                if (!$cmt.find('.replies-toggle').length) {
                    const $toggleBtn = $(`
                <div class="replies-toggle" style="cursor:pointer; color:#6a3ae4; font-size:13px; margin-top:5px;">
                    답글 접기
                </div>
            `);
                    $toggleBtn.click(() => {
                        if ($replies.is(':visible')) {
                            $replies.hide();
                            $toggleBtn.text('답글 펼치기');
                        } else {
                            $replies.show();
                            $toggleBtn.text('답글 접기');
                        }
                    });
                    $cmt.find('.actions').after($toggleBtn);
                }
            });

            // 일반 댓글일 경우 .replies 박스 생성
            if (!isReply) {
                $cmt.after('<div class="replies"></div>');
            }

            return $cmt;
        }

        //공유click
        $('.share-btn').click(function () {
            $('#sharePopup').toggle();
        });

        //신고click
        $('.report-btn').click(function () {
            alert("신고가 접수되었습니다.");
        });

        //url 복사 함수
        function copyUrl() {
            const urlInput = document.getElementById("shareUrl");
            urlInput.select();
            urlInput.setSelectionRange(0, 99999); // For mobile
            document.execCommand("copy");
            alert("URL이 복사되었습니다!");
        }

    </script>
</body>

</html>